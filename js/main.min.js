var songs,currentTheme,currentEvents,rainbowLoop1,rainbowLoop2,config,snowLoop,now,deadline,clockLoop,otherItemsMessage,songIndex=0,bypassHashChange=!1,playing=!1,looping=!1,shuffling=!1,currentEventIndex=0,currentDateIndex=0,serverDateOffset=0,serverDateUncertainty=0;const song=document.getElementById("player");song.pause();const errorMsg=(errorType,error)=>{console.error("%c%s Error","font-weight:bold;text-decoration:underline;font-size:25px;",errorType),console.error("%c%s","font-size:15px;",error)},generateNum=max=>Math.floor(Math.random()*max),playPause=()=>{!1===playing?(song.play(),document.getElementById("play-pause").src="img/pause.png",playing=!0,localStorage.setItem("schoolCountSongNum_"+currentTheme,songIndex)):!0===playing&&(song.pause(),document.getElementById("play-pause").src="img/play.png",playing=!1,localStorage.setItem("schoolCountSongNum_"+currentTheme,songIndex))},changeLoop=()=>{!1===looping?(song.loop=!0,document.getElementById("loop").src="img/loop_1.png",looping=!0,localStorage.setItem("schoolCountLoop",!0)):!0===looping&&(song.loop=!1,document.getElementById("loop").src="img/loop_all.png",looping=!1,localStorage.setItem("schoolCountLoop",!1))},changeShuffle=()=>{!1===shuffling?(document.getElementById("shuffle").src="img/shuffle-on.png",shuffling=!0,localStorage.setItem("schoolCountShuffle",!0)):!0===shuffling&&(document.getElementById("shuffle").src="img/shuffle-off.png",shuffling=!1,localStorage.setItem("schoolCountShuffle",!1))},next=()=>{if(!1===shuffling)++songIndex>songs.length-1&&(songIndex=0);else{var randomNumber=generateNum(songs.length);randomNumber!=songIndex&&(songIndex=randomNumber)}song.src=songs[songIndex],playing=!1,playPause()},previous=()=>{if(!1===shuffling)--songIndex<0&&(songIndex=songs.length-1);else{var randomNumber=generateNum(songs.length);randomNumber!=songIndex&&(songIndex=randomNumber)}song.src=songs[songIndex],playing=!1,playPause()};song&&song.addEventListener("ended",()=>{next()});var volSlider=document.getElementById("volume");volSlider.value=100,volSlider.addEventListener("input",()=>{song.volume=volSlider.value/100,localStorage.setItem("schoolCountVolume",volSlider.value)},!1);const refreshIndex=()=>{null!==localStorage.getItem("schoolCountSongNum_"+currentTheme)&&(!0!==localStorage.getItem("gkEaster")||songs.includes("audio/Gimkit.mp3")||songs.push("audio/Gimkit.mp3"),!0!==localStorage.getItem("ktEaster")||songs.includes("audio/Kahoot.mp3")||songs.push("audio/Kahoot.mp3"),parseInt(localStorage.getItem("schoolCountSongNum_"+currentTheme))>songs.length&&localStorage.setItem("schoolCountSongNum_"+currentTheme,0),songIndex=parseInt(localStorage.getItem("schoolCountSongNum_"+currentTheme)),song.src=songs[songIndex])},changeTheme=(themeName,bypassChange)=>{currentTheme==themeName&&!0!==bypassChange||(playing=!0,playPause(),fetch(`json/themes/${themeName}.json`,{cache:"no-store"}).then(response=>response.json()).then(ajaxData=>{try{for(var cssArr of(currentTheme=themeName,localStorage.setItem("schoolCountTheme_"+currentEvents,themeName),songs=ajaxData.songs,song.src=ajaxData.songs[0],refreshIndex(),document.querySelector('meta[name="theme-color"]').setAttribute("content",ajaxData.css[0][1]),ajaxData.css))document.documentElement.style.setProperty("--"+cssArr[0],cssArr[1]);!0===ajaxData.hammer_sickle?document.getElementById("hammer-sickle")||document.getElementById("clockdiv").insertAdjacentHTML("beforebegin",'<div id="hammer-sickle"><svg xmlns="http://www.w3.org/2000/svg" width="331pt" height="331pt" viewBox="0 0 331 331"><rect width="331" height="331" fill="#de2910" /><path d="m165.49 15.47c30.28 10.787 58.307 27.796 81.948 49.566 22.675 21.132 41.915 47.019 51.072 76.93 6.2062 19.233 4.9292 40.017 0.82663 59.543-4.0982 18.189-12.101 35.528-23.755 50.119 13.217 12.923 26.307 25.974 39.558 38.863-1.7648 6.603-4.4693 13.351-9.8987 17.802-4.5399 3.9187-10.352 5.8133-16.072 7.2378-12.941-13.445-25.948-26.823-38.896-40.261-16.129 11.019-35.594 16.827-55.031 17.685-24.481 1.0821-48.954-6.8092-68.929-20.826-10.771-7.4027-20.48-16.254-29.387-25.794-1.5255 1.5006-3.1903 2.847-4.9022 4.1295 0.42452 3.2013 0.88448 6.3985 1.3259 9.6005-3.3426 0.19229-6.6797 1.0096-9.4884 2.8931-8.6657 5.4918-14.683 14.017-20.834 22.02-7.6271 9.9016-14.482 20.892-25.111 27.906-6.4414 3.9792-15.973 2.2974-19.918-4.3912-4.1259-6.5622-1.7458-15.032 2.6981-20.789 10.861-15.963 30.253-22.786 42.394-37.492 3.1577-3.9512 5.5457-8.5309 6.7303-13.461 3.101 0.19817 6.2023 0.39974 9.3044 0.60175 2.6274-2.6649 5.2677-5.3163 7.8851-7.9898 2.9183-0.0754 5.8923 0.23651 8.7736-0.32607 3.0076-2.6527 5.4052-5.9141 8.1214-8.8522 2.9751 0.8335 4.6657 3.6241 6.8187 5.617 13.307 12.12 28.525 22.682 45.869 28.068 22.179 7.1054 46.889 4.8481 67.694-5.4908-41.672-42.905-83.205-85.947-124.82-128.91-9.3317 9.8253-18.627 19.688-28.092 29.385-11.559-11.792-23.231-23.473-34.849-35.207 21.898-21.92 44.042-43.594 66.061-65.393 19.037 5.1825 38.049 10.456 57.103 15.577-13.021 11.821-26.257 23.403-39.323 35.173 43.419 42.566 86.622 85.358 130.11 127.86 10.498-12.773 16.407-29.037 17.21-45.504 1.4809-21.788-3.5608-43.463-10.743-63.901-10.152-26.973-29.562-49.179-50.658-68.282-13.185-11.72-26.774-23.002-40.801-33.701z" fill="#ffd600"/></svg></div>'):document.getElementById("hammer-sickle")&&document.getElementById("hammer-sickle").remove(),!0===ajaxData.rainbow?(rainbowLoop1||(rainbowLoop1=setInterval(()=>{document.documentElement.style.setProperty("--rainbow-color","#"+Math.floor(16777215*Math.random()).toString(16))},1)),rainbowLoop2||(rainbowLoop2=setInterval(()=>{document.documentElement.style.setProperty("--rainbow-color-2","#"+Math.floor(16777215*Math.random()).toString(16))},1))):(rainbowLoop1&&(clearInterval(rainbowLoop1),rainbowLoop1=null),rainbowLoop2&&(clearInterval(rainbowLoop2),rainbowLoop2=null))}catch(error){changeTheme("default",bypassChange),errorMsg("Theme",error)}}).catch(error=>{changeTheme("default",bypassChange),errorMsg("Theme",error)}))},eventCountdownReset=()=>{deadline=new Date(config.mainEvents[currentEventIndex].dates[currentDateIndex]),document.getElementById("day").classList.contains("blinking")&&(document.getElementById("day").classList.remove("blinking"),document.getElementById("hour").classList.remove("blinking"),document.getElementById("minute").classList.remove("blinking"),document.getElementById("second").classList.remove("blinking")),!0===config.mainEvents[currentEventIndex].snowingMode?snowLoop||(snowLoop=setInterval(()=>{var snowFlake=document.createElement("i");snowFlake.classList.add("fas"),snowFlake.classList.add("fa-snowflake"),snowFlake.style.left=Math.random()*window.innerWidth+"px",snowFlake.style.animationDuration=3*Math.random()+2+"s",snowFlake.style.opacity=Math.random(),snowFlake.style.fontSize=10*Math.random()+10+"px",document.body.appendChild(snowFlake),setTimeout(()=>{snowFlake.remove()},5e3)},150)):snowLoop&&(clearInterval(snowLoop),snowLoop=null),document.getElementById("pyro")&&document.getElementById("pyro").remove(),document.getElementById("endtext").innerHTML=otherItemsMessage,document.getElementById("title").innerHTML=config.mainEvents[currentEventIndex].title,eventCountdownLoop(),clockLoop=setInterval(eventCountdownLoop,500)},eventCountdownLoop=()=>{now=new Date(Date.now()+serverDateOffset);var timeDiff=deadline.getTime()-now.getTime(),days=Math.floor(timeDiff/864e5),hours=Math.floor(timeDiff%864e5/36e5),minutes=Math.floor(timeDiff%36e5/6e4),seconds=Math.floor(timeDiff%6e4/1e3);if(document.getElementById("day").innerHTML=days.toString().padStart(2,"0"),document.getElementById("hour").innerHTML=hours.toString().padStart(2,"0"),document.getElementById("minute").innerHTML=minutes.toString().padStart(2,"0"),document.getElementById("second").innerHTML=seconds.toString().padStart(2,"0"),timeDiff<0){if(clearInterval(clockLoop),clockLoop=null,document.getElementById("day").innerHTML="00",document.getElementById("hour").innerHTML="00",document.getElementById("minute").innerHTML="00",document.getElementById("second").innerHTML="00",document.getElementById("day").classList.add("blinking"),document.getElementById("hour").classList.add("blinking"),document.getElementById("minute").classList.add("blinking"),document.getElementById("second").classList.add("blinking"),document.getElementById("endtext").innerHTML=config.mainEvents[currentEventIndex].endMessage,!0===config.mainEvents[currentEventIndex].endFireworks){if(!document.getElementById("firework-css")){var fireworkCSS=document.createElement("link");fireworkCSS.id="firework-css",fireworkCSS.setAttribute("rel","stylesheet"),fireworkCSS.setAttribute("href","css/fireworks.min.css"),document.getElementsByTagName("head")[0].appendChild(fireworkCSS)}if(!document.getElementById("pyro")){var pyroDiv=document.createElement("div");pyroDiv.classList.add("pyro"),pyroDiv.id="pyro",document.body.appendChild(pyroDiv)}}setTimeout(()=>{currentDateIndex<config.mainEvents[currentEventIndex].dates.length-1?(currentDateIndex++,eventCountdownReset()):currentDateIndex==config.mainEvents[currentEventIndex].dates.length-1&&currentEventIndex<config.mainEvents.length-1&&(currentDateIndex=0,currentEventIndex++,eventCountdownReset())},1e4)}},changeEvent=(eventsName,bypassChange=!1)=>{currentEvents==eventsName&&!0!==bypassChange||(playing=!0,playPause(),fetch(`json/events/${eventsName}.json`,{cache:"no-store"}).then(response=>response.json()).then(ajaxData=>{try{"default"!=(currentEvents=eventsName)?(bypassHashChange=!0,location.hash=currentEvents,bypassHashChange=!1):(bypassHashChange=!0,history.pushState("",document.title,location.pathname),bypassHashChange=!1);var eventIndexFound=!1,dateIndexFound=!1;if((config=ajaxData).mainEvents.forEach((event,eventIndex)=>{!0!==eventIndexFound&&(currentEventIndex=eventIndex,event.dates.forEach((date,dateIndex)=>{!0!==dateIndexFound&&(new Date(date)>new Date&&(eventIndexFound=!0,dateIndexFound=!0),currentDateIndex=dateIndex)}))}),otherItemsMessage=config.otherItemsTitle,config.otherItemsDescription.length>0){var lang=config.lang;for(var event of config.otherItemsDescription)if(event.hasOwnProperty("date")){let dateParse=event.date,dateFormatted=new Date(dateParse).toLocaleDateString(lang,{month:"short",day:"numeric"});otherItemsMessage+="<br>"+event.name+event.separator+dateFormatted}else otherItemsMessage+="<br>"+event.name+event.separator+event.text}clearInterval(clockLoop),clockLoop=null,eventCountdownReset(),null!==localStorage.getItem("schoolCountTheme_"+currentEvents)?changeTheme(localStorage.getItem("schoolCountTheme_"+currentEvents),bypassChange):localStorage.setItem("schoolCountTheme_"+currentEvents,currentTheme)}catch(error){changeEvent("default"),errorMsg("Event",error)}}).catch(error=>{changeEvent("default"),errorMsg("Event",error)}))};if(null!==localStorage.getItem("schoolCountVolume")&&(volSlider.value=parseInt(localStorage.getItem("schoolCountVolume")),song.volume=volSlider.value/100),!0===localStorage.getItem("schoolCountLoop")&&(looping=!1,changeLoop()),!0===localStorage.getItem("schoolCountShuffle")&&(shuffling=!1,changeShuffle()),location.hash.length>1&&(currentEvents=location.hash.slice(1)),null!==localStorage.getItem("schoolCountTheme_"+currentEvents)&&(currentTheme=localStorage.getItem("schoolCountTheme_"+currentEvents)),changeEvent(currentEvents,!0),window.addEventListener("hashchange",()=>{!1===bypassHashChange&&location.hash.length>1?changeEvent(location.hash.slice(1)):bypassHashChange=!1}),!0===syncMode){const setServerDate=async()=>{const result=await getServerDate();serverDateOffset=result.offset,serverDateUncertainty=result.uncertainty,console.log(`The client date is off by ${serverDateOffset} ms +/- ${serverDateUncertainty} ms.`)};setServerDate(),setInterval(setServerDate,6e5)}