var songs,currentTheme,currentEvents,rainbowLoop1,rainbowLoop2,config,snowLoop,now,deadline,clockLoop,otherItemsMessage,songIndex=0,bypassHashChange=!1,playing=!1,looping=!1,shuffling=!1,currentEventIndex=0,currentDateIndex=0,serverDateOffset=0,serverDateUncertainty=0;const player=document.getElementById("player");player.pause();const errorMsg=(a,b)=>{console.error("%c%s Error","font-weight:bold;text-decoration:underline;font-size:25px;",a),console.error("%c%s","font-size:15px;",b)},generateNum=a=>Math.floor(Math.random()*a),playPause=()=>{!1===playing?(player.play(),document.getElementById("play-pause").src="img/pause.png",playing=!0,localStorage.setItem("schoolCountSongNum_"+currentTheme,songIndex)):!0==playing&&(player.pause(),document.getElementById("play-pause").src="img/play.png",playing=!1,localStorage.setItem("schoolCountSongNum_"+currentTheme,songIndex))},changeLoop=()=>{!1===looping?(player.loop=!0,document.getElementById("loop").src="img/loop_1.png",looping=!0,localStorage.setItem("schoolCountLoop",!0)):!0==looping&&(player.loop=!1,document.getElementById("loop").src="img/loop_all.png",looping=!1,localStorage.setItem("schoolCountLoop",!1))},changeShuffle=()=>{!1===shuffling?(document.getElementById("shuffle").src="img/shuffle-on.png",shuffling=!0,localStorage.setItem("schoolCountShuffle",!0)):!0==shuffling&&(document.getElementById("shuffle").src="img/shuffle-off.png",shuffling=!1,localStorage.setItem("schoolCountShuffle",!1))},next=()=>{if(!1===shuffling)songIndex++,songIndex>songs.length-1&&(songIndex=0);else{var a=generateNum(songs.length);a!=songIndex&&(songIndex=a)}player.src=songs[songIndex],playing=!1,playPause()},previous=()=>{if(!1===shuffling)songIndex--,0>songIndex&&(songIndex=songs.length-1);else{var a=generateNum(songs.length);a!=songIndex&&(songIndex=a)}player.src=songs[songIndex],playing=!1,playPause()};player&&player.addEventListener("ended",()=>{next()});var volSlider=document.getElementById("volume");volSlider.value=100,volSlider.addEventListener("input",()=>{player.volume=volSlider.value/100,localStorage.setItem("schoolCountVolume",volSlider.value)},!1);const refreshIndex=()=>{null!==localStorage.getItem("schoolCountSongNum_"+currentTheme)&&(!0===localStorage.getItem("gkEaster")&&!songs.includes("audio/Gimkit.mp3")&&songs.push("audio/Gimkit.mp3"),!0===localStorage.getItem("ktEaster")&&!songs.includes("audio/Kahoot.mp3")&&songs.push("audio/Kahoot.mp3"),parseInt(localStorage.getItem("schoolCountSongNum_"+currentTheme))>songs.length&&localStorage.setItem("schoolCountSongNum_"+currentTheme,0),songIndex=parseInt(localStorage.getItem("schoolCountSongNum_"+currentTheme)),player.src=songs[songIndex])},changeTheme=(a,b)=>{(currentTheme!=a||!0===b)&&(playing=!0,playPause(),fetch(`json/themes/${a}.json`,{cache:"no-store"}).then(a=>a.json()).then(c=>{try{currentTheme=a,localStorage.setItem("schoolCountTheme_"+currentEvents,a),songs=c.songs,player.src=c.songs[0],refreshIndex(),document.querySelector("meta[name=\"theme-color\"]").setAttribute("content",c.css[0][1]);for(var d of c.css)document.documentElement.style.setProperty("--"+d[0],d[1]);!0===c.hammer_sickle?!document.getElementById("hammer-sickle")&&document.getElementById("clockdiv").insertAdjacentHTML("beforebegin","<div id=\"hammer-sickle\"><svg xmlns=\"http://www.w3.org/2000/svg\" width=\"331pt\" height=\"331pt\" viewBox=\"0 0 331 331\"><rect width=\"331\" height=\"331\" fill=\"#de2910\" /><path d=\"m165.49 15.47c30.28 10.787 58.307 27.796 81.948 49.566 22.675 21.132 41.915 47.019 51.072 76.93 6.2062 19.233 4.9292 40.017 0.82663 59.543-4.0982 18.189-12.101 35.528-23.755 50.119 13.217 12.923 26.307 25.974 39.558 38.863-1.7648 6.603-4.4693 13.351-9.8987 17.802-4.5399 3.9187-10.352 5.8133-16.072 7.2378-12.941-13.445-25.948-26.823-38.896-40.261-16.129 11.019-35.594 16.827-55.031 17.685-24.481 1.0821-48.954-6.8092-68.929-20.826-10.771-7.4027-20.48-16.254-29.387-25.794-1.5255 1.5006-3.1903 2.847-4.9022 4.1295 0.42452 3.2013 0.88448 6.3985 1.3259 9.6005-3.3426 0.19229-6.6797 1.0096-9.4884 2.8931-8.6657 5.4918-14.683 14.017-20.834 22.02-7.6271 9.9016-14.482 20.892-25.111 27.906-6.4414 3.9792-15.973 2.2974-19.918-4.3912-4.1259-6.5622-1.7458-15.032 2.6981-20.789 10.861-15.963 30.253-22.786 42.394-37.492 3.1577-3.9512 5.5457-8.5309 6.7303-13.461 3.101 0.19817 6.2023 0.39974 9.3044 0.60175 2.6274-2.6649 5.2677-5.3163 7.8851-7.9898 2.9183-0.0754 5.8923 0.23651 8.7736-0.32607 3.0076-2.6527 5.4052-5.9141 8.1214-8.8522 2.9751 0.8335 4.6657 3.6241 6.8187 5.617 13.307 12.12 28.525 22.682 45.869 28.068 22.179 7.1054 46.889 4.8481 67.694-5.4908-41.672-42.905-83.205-85.947-124.82-128.91-9.3317 9.8253-18.627 19.688-28.092 29.385-11.559-11.792-23.231-23.473-34.849-35.207 21.898-21.92 44.042-43.594 66.061-65.393 19.037 5.1825 38.049 10.456 57.103 15.577-13.021 11.821-26.257 23.403-39.323 35.173 43.419 42.566 86.622 85.358 130.11 127.86 10.498-12.773 16.407-29.037 17.21-45.504 1.4809-21.788-3.5608-43.463-10.743-63.901-10.152-26.973-29.562-49.179-50.658-68.282-13.185-11.72-26.774-23.002-40.801-33.701z\" fill=\"#ffd600\"/></svg></div>"):document.getElementById("hammer-sickle")&&document.getElementById("hammer-sickle").remove(),!0===c.rainbow?(!rainbowLoop1&&(rainbowLoop1=setInterval(()=>{document.documentElement.style.setProperty("--rainbow-color","#"+Math.floor(16777215*Math.random()).toString(16))},1)),!rainbowLoop2&&(rainbowLoop2=setInterval(()=>{document.documentElement.style.setProperty("--rainbow-color-2","#"+Math.floor(16777215*Math.random()).toString(16))},1))):(rainbowLoop1&&(clearInterval(rainbowLoop1),rainbowLoop1=null),rainbowLoop2&&(clearInterval(rainbowLoop2),rainbowLoop2=null))}catch(a){changeTheme("default",b),errorMsg("Theme",a)}}).catch(a=>{changeTheme("default",b),errorMsg("Theme",a)}))},eventCountdownReset=()=>{deadline=new Date(config.mainEvents[currentEventIndex].dates[currentDateIndex]),document.getElementById("day").classList.contains("blinking")&&(document.getElementById("day").classList.remove("blinking"),document.getElementById("hour").classList.remove("blinking"),document.getElementById("minute").classList.remove("blinking"),document.getElementById("second").classList.remove("blinking")),!0===config.mainEvents[currentEventIndex].snowingMode?!snowLoop&&(snowLoop=setInterval(()=>{var a=document.createElement("i");a.classList.add("fas"),a.classList.add("fa-snowflake"),a.style.left=Math.random()*window.innerWidth+"px",a.style.animationDuration=3*Math.random()+2+"s",a.style.opacity=Math.random(),a.style.fontSize=10*Math.random()+10+"px",document.body.appendChild(a),setTimeout(()=>{a.remove()},5e3)},150)):snowLoop&&(clearInterval(snowLoop),snowLoop=null),document.getElementById("pyro")&&document.getElementById("pyro").remove(),document.getElementById("endtext").innerHTML=otherItemsMessage,document.getElementById("title").innerHTML=config.mainEvents[currentEventIndex].title,eventCountdownLoop(),clockLoop=setInterval(eventCountdownLoop,500)},eventCountdownLoop=()=>{if(now=new Date(Date.now()+serverDateOffset),!config.mainEvents[currentEventIndex].fullDay)var a=deadline.getTime()-now.getTime();else var a=new Date(deadline.getFullYear(),deadline.getMonth(),deadline.getDate(),0,0,0).getTime()-now.getTime();var b=Math.floor(a/86400000),c=Math.floor(a%86400000/3600000),d=Math.floor(a%3600000/60000),e=Math.floor(a%60000/1e3);if(document.getElementById("day").innerHTML=b.toString().padStart(2,"0"),document.getElementById("hour").innerHTML=c.toString().padStart(2,"0"),document.getElementById("minute").innerHTML=d.toString().padStart(2,"0"),document.getElementById("second").innerHTML=e.toString().padStart(2,"0"),0>a){var f=setInterval(()=>{clockLoop&&(clearInterval(clockLoop),clockLoop=null,clearInterval(f),f=null)},500);if(document.getElementById("day").innerHTML="00",document.getElementById("hour").innerHTML="00",document.getElementById("minute").innerHTML="00",document.getElementById("second").innerHTML="00",document.getElementById("day").classList.add("blinking"),document.getElementById("hour").classList.add("blinking"),document.getElementById("minute").classList.add("blinking"),document.getElementById("second").classList.add("blinking"),document.getElementById("endtext").innerHTML=config.mainEvents[currentEventIndex].endMessage,!0===config.mainEvents[currentEventIndex].endFireworks){if(!document.getElementById("firework-css")){var g=document.createElement("link");g.id="firework-css",g.setAttribute("rel","stylesheet"),g.setAttribute("href","css/fireworks.min.css"),document.getElementsByTagName("head")[0].appendChild(g)}if(!document.getElementById("pyro")){var h=document.createElement("div");h.classList.add("pyro"),h.id="pyro",document.body.appendChild(h)}}if(config.mainEvents[currentEventIndex].fullDay){deadline=deadline.setDate(deadline.getDate()+1);var i=setInterval(()=>{now=new Date(Date.now()+serverDateOffset),now>deadline&&(clearInterval(i),i=null,eventCountdownReset())},500)}else setTimeout(()=>{currentDateIndex<config.mainEvents[currentEventIndex].dates.length-1?(currentDateIndex++,eventCountdownReset()):currentDateIndex===config.mainEvents[currentEventIndex].dates.length-1&&currentEventIndex<config.mainEvents.length-1&&(currentDateIndex=0,currentEventIndex++,eventCountdownReset())},1e4)}},changeEvent=(a,b=!1)=>{(currentEvents!=a||!0===b)&&(playing=!0,playPause(),fetch(`json/events/${a}.json`,{cache:"no-store"}).then(a=>a.json()).then(c=>{try{currentEvents=a,"default"==currentEvents?(bypassHashChange=!0,history.pushState("",document.title,location.pathname),bypassHashChange=!1):(bypassHashChange=!0,location.hash=currentEvents,bypassHashChange=!1),config=c;var d=!1,e=!1;if(config.mainEvents.forEach((a,b)=>{!0===d||(currentEventIndex=b,a.dates.forEach((b,c)=>{!0===e||(!0===a.fullDay?(tmp=new Date(b),tmp=new Date(tmp.getFullYear(),tmp.getMonth(),tmp.getDate()+1,0,0,0),new Date<tmp&&(d=!0,e=!0)):new Date(b)>new Date&&(d=!0,e=!0),currentDateIndex=c)}))}),otherItemsMessage=config.otherItemsTitle,0<config.otherItemsDescription.length){var f=config.lang;for(var g of config.otherItemsDescription)if(g.hasOwnProperty("date")){let a=g.date,b=new Date(a).toLocaleDateString(f,{month:"short",day:"numeric"});otherItemsMessage+="<br>"+g.name+g.separator+b}else otherItemsMessage+="<br>"+g.name+g.separator+g.text}clearInterval(clockLoop),clockLoop=null,eventCountdownReset(),null===localStorage.getItem("schoolCountTheme_"+currentEvents)?localStorage.setItem("schoolCountTheme_"+currentEvents,currentTheme):changeTheme(localStorage.getItem("schoolCountTheme_"+currentEvents),b)}catch(a){changeEvent("default"),errorMsg("Event",a)}}).catch(a=>{changeEvent("default"),errorMsg("Event",a)}))};if(null!==localStorage.getItem("schoolCountVolume")&&(volSlider.value=parseInt(localStorage.getItem("schoolCountVolume")),player.volume=volSlider.value/100),!0===localStorage.getItem("schoolCountLoop")&&(looping=!1,changeLoop()),!0===localStorage.getItem("schoolCountShuffle")&&(shuffling=!1,changeShuffle()),1<location.hash.length&&(currentEvents=location.hash.slice(1)),null!==localStorage.getItem("schoolCountTheme_"+currentEvents)&&(currentTheme=localStorage.getItem("schoolCountTheme_"+currentEvents)),changeEvent(currentEvents,!0),window.addEventListener("hashchange",()=>{!1===bypassHashChange&&1<location.hash.length?changeEvent(location.hash.slice(1)):bypassHashChange=!1}),!0===syncMode){const a=async()=>{const a=await getServerDate();serverDateOffset=a.offset,serverDateUncertainty=a.uncertainty,console.log(`The client date is off by ${serverDateOffset} ms +/- ${serverDateUncertainty} ms.`)};a(),setInterval(a,6e5)}