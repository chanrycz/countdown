const fetchSampleImplementation=async()=>{const requestDate=new Date,{headers:headers,ok:ok,statusText:statusText}=await fetch(window.location,{cache:"no-store",method:"HEAD"});if(!ok)throw new Error(`Bad date sample from server: ${statusText}`);return{requestDate:requestDate,responseDate:new Date,serverDate:new Date(headers.get("Date"))}},getServerDate=async({fetchSample:fetchSample}={fetchSample:fetchSampleImplementation})=>{let best={uncertainty:Number.MAX_VALUE};for(let index=0;index<15;index++)try{const{requestDate:requestDate,responseDate:responseDate,serverDate:serverDate}=await fetchSample(),uncertainty=(responseDate-requestDate)/2+500;if(uncertainty<best.uncertainty){const date=new Date(serverDate.getTime()+500);best={date:date,offset:date-responseDate,uncertainty:uncertainty}}}catch(exception){console.warn(exception)}return best};